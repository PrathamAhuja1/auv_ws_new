# ============================================================================
# SAUVC QUALIFICATION PARAMETERS - COMPLETE FILE
# CRITICAL: U-turn parameters optimized to prevent surfacing
# ============================================================================

qualification_detector_node:
  ros__parameters:
    # HSV color ranges for orange gate posts
    # Orange covers range 0-35 in H channel to catch variations
    red_lower1: [0, 100, 100]
    red_upper1: [10, 255, 255]
    red_lower2: [170, 100, 100]
    red_upper2: [180, 255, 255]
    
    green_lower: [40, 100, 100]
    green_upper: [80, 255, 255]
    
    orange_lower: [10, 120, 120]
    orange_upper: [25, 255, 255]
    
    # Detection parameters
    min_area_strict: 300      # Minimum area for confident detection
    min_area_relaxed: 80      # Minimum area for partial detection
    aspect_threshold: 0.8     # Minimum aspect ratio for valid post
    gate_width_meters: 1.5    # Physical gate width (1.5m)
    
    # Debug visualization
    publish_debug: true


qualification_navigator_node:
  ros__parameters:
    # ========================================================================
    # MISSION PARAMETERS
    # ========================================================================
    
    # Target depth (negative is below water surface)
    target_depth: -0.8
    
    # Depth control tuning
    depth_deadband: 0.1       # Ignore errors smaller than 10cm
    depth_gain_weak: 0.5      # Gain for small corrections
    depth_gain_strong: 1.5    # Gain for large corrections
    
    # ========================================================================
    # NAVIGATION SPEEDS
    # ========================================================================
    
    # Search phase
    search_speed: 0.3          # Forward speed while searching (m/s)
    
    # Approach phase (far to gate)
    approach_speed: 0.5        # Speed when approaching gate (m/s)
    approach_stop_distance: 3.0  # Distance to stop and align (m)
    
    # Alignment phase
    alignment_distance: 3.0    # Distance at which to align (m)
    alignment_threshold: 0.06  # Alignment tolerance (6% of frame)
    alignment_max_time: 20.0   # Maximum time to spend aligning (s)
    
    # Final approach
    final_approach_speed: 0.5  # Speed for final approach (m/s)
    
    # Passing through gate
    passing_trigger_distance: 1.0  # Distance to commit to passage (m)
    passing_speed: 1.0         # Speed while passing through (m/s)
    passing_duration: 6.0      # Expected passage duration (s)
    
    # ========================================================================
    # CRITICAL: U-TURN PARAMETERS - EXTREME ANTI-SURFACING MODE
    # ========================================================================
    # These parameters are CRITICAL to prevent the AUV from surfacing
    # during the U-turn maneuver. DO NOT increase these values without
    # careful testing, as higher speeds will cause surfacing.
    # ========================================================================
    
    # VERY SLOW forward speed during U-turn
    # This minimizes hydrodynamic lift forces that push the AUV upward
    # Previous value: 0.4 m/s (CAUSED SURFACING)
    # Current value: 0.12 m/s (PREVENTS SURFACING)
    uturn_forward_speed: 0.12
    
    # Slower angular velocity for stability
    # Prevents turbulence and water disturbance that creates upward forces
    # Previous value: 0.5 rad/s (too aggressive)
    # Current value: 0.30 rad/s (controlled rotation)
    uturn_angular_speed: 0.30
    
    # Target depth during U-turn
    # The AUV will aggressively maintain this depth
    uturn_depth: -0.8
    
    # STRONG downward bias (NEW PARAMETER)
    # This applies a constant downward thrust during the U-turn to
    # pre-emptively compensate for hydrodynamic lift forces
    # This is the KEY to preventing surfacing
    # Value: -0.4 m/s downward thrust bias
    uturn_depth_bias: -0.4
    
    # ========================================================================
    # NOTES ON U-TURN PARAMETERS:
    # 
    # The U-turn is the most challenging part of the qualification mission
    # because forward motion during rotation creates upward lift forces.
    # 
    # The solution uses a 4-layer approach:
    # 1. Minimize the problem: Very slow forward speed (0.12 m/s)
    # 2. Aggressive control: 5x-6x depth control gains in the navigator
    # 3. Pre-emptive compensation: Constant downward bias (-0.4 m/s)
    # 4. Emergency prevention: Force maximum downward if getting shallow
    # 
    # Expected U-turn behavior:
    # - Duration: 10-12 seconds (slower is safer)
    # - Depth variation: ±0.10m around target depth (-0.8m)
    # - No surfacing warnings
    # - Smooth 180° rotation
    # 
    # If surfacing still occurs, try:
    # - Increase bias: uturn_depth_bias: -0.5
    # - Reduce speed: uturn_forward_speed: 0.10
    # - Reduce rotation: uturn_angular_speed: 0.25
    # ========================================================================